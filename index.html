<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Interactive Periodic Table</title>

    <!-- Meta Description -->
    <meta name="description" content="An interactive 3D Periodic Table that allows exploration of elements with detailed information, electron configurations, and a visually engaging Bohr model representation.">

    <!-- Favicon Links -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/webmanifest.json">
    <link rel="shortcut icon" href="favicon/favicon.ico">

    <!-- Open Graph Meta Tags (for social sharing) -->
    <meta property="og:title" content="3D Interactive Periodic Table">
    <meta property="og:description" content="Explore all chemical elements in an interactive 3D environment with detailed properties, electron configurations, and hazard information.">
    <meta property="og:image" content="https://i.ibb.co/23zHC9dq/og1.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://drbaph.is-a.dev/PeriodicTable-old/">

    <!-- Twitter Card (for better previews on Twitter) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="3D Interactive Periodic Table">
    <meta name="twitter:description" content="Explore all chemical elements in an interactive 3D environment with detailed properties, electron configurations, and hazard information.">
    <meta name="twitter:image" content="https://i.ibb.co/23zHC9dq/og1.jpg">

    <!-- Import Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Import React -->
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <!-- Import Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Import Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Import OrbitControls for Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }
        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        .element-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px;
            border-radius: 3px;
            display: none;
            z-index: 2;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 24px;
        }
        /* Element categories colors */
        .alkali-metal { background-color: #ff8a80; }
        .alkaline-earth { background-color: #ff80ab; }
        .transition-metal { background-color: #ea80fc; }
        .post-transition { background-color: #b388ff; }
        .metalloid { background-color: #8c9eff; }
        .nonmetal { background-color: #82b1ff; }
        .halogen { background-color: #80d8ff; }
        .noble-gas { background-color: #84ffff; }
        .lanthanide { background-color: #a7ffeb; }
        .radioactive-icon { background-color: #ffeb3b; color: black; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .toxic-icon { background-color: #9c27b0; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .extreme-toxic-icon { background-color: #f44336; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .carcinogenic-icon { background-color: #7e57c2; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .corrosive-icon { background-color: #e91e63; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .flammable-icon { background-color: #ff5722; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .water-reactive-icon { background-color: #2196f3; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .asphyxiant-icon { background-color: #78909c; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .pyrophoric-icon { background-color: #ff9800; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .oxidizer-icon { background-color: #009688; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .special-icon { background-color: #3f51b5; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .unknown { background-color: #e6ee9c; }

        /* Custom scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* Firefox scrollbar styling */
        * {
            scrollbar-width: thin;
            scrollbar-color: #4b5563 #1f2937;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="loading" class="loading-overlay">
        Loading Periodic Table... Please wait.
    </div>

    <div id="canvas-container"></div>
    <div id="app-root"></div>
    <div class="element-tooltip" id="element-tooltip"></div>

    <script type="text/babel">
        // Main React Component
        const App = () => {
            const [selectedElement, setSelectedElement] = React.useState(null);
            const [isLoading, setIsLoading] = React.useState(true);
            const [view, setView] = React.useState('table'); // 'table' or 'atom'
            const [elementData, setElementData] = React.useState({});
            const [searchTerm, setSearchTerm] = React.useState('');
            const [searchResults, setSearchResults] = React.useState([]);
            const [showDropdown, setShowDropdown] = React.useState(false);
            const [infoPanelOpen, setInfoPanelOpen] = React.useState(true);
            
            
            React.useEffect(() => {
                // Initialize the periodic table
                initPeriodicTable();
                
                // Load element data
                loadElementData().then(() => {
                    setIsLoading(false);
                    document.getElementById('loading').style.display = 'none';
                    
                    // Store element data for search functionality
                    const data = {};
                    Object.values(elementsData).forEach(element => {
                        data[element.number] = element;
                    });
                    setElementData(data);
                });
                
                // Initialize hazard data
                initElementHazards();
                
                // Listen for element selection events
                document.addEventListener('elementSelected', function(e) {
                    const element = e.detail;
                    setSelectedElement(element);
                    setView('atom');
                    createAtomicModel(element);
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#search-container')) {
                        setShowDropdown(false);
                    }
                });
            }, []);
            
            // Handle search input change
            const handleSearchChange = (e) => {
                const value = e.target.value;
                setSearchTerm(value);
                
                if (value.trim() === '') {
                    setSearchResults([]);
                    setShowDropdown(false);
                    return;
                }
                
                // Check if searching for a hazard property
                const hazardTerms = {
                    'toxic': ['Be', 'As', 'Pb', 'Hg', 'Cd', 'Tl', 'Os', 'Po', 'Pu', 'F', 'Cl', 'Br', 'I', 'Sb', 'Te', 'Ba', 'Cs', 'Li', 'Na', 'K', 'Rb', 'V', 'Cr', 'Co', 'Ni', 'Se', 'P', 'U'],
                    'extremely toxic': ['Pb', 'Hg', 'Cd', 'As', 'Be', 'Tl', 'Po', 'F'],
                    'carcinogenic': ['Be', 'Cd', 'Ni', 'As', 'Cr'],
                    'corrosive': ['F', 'Cl', 'Br', 'I', 'Li', 'Na', 'K', 'Rb', 'Cs', 'Fr'],
                    'flammable': ['H', 'Li', 'Na', 'K', 'Rb', 'Cs', 'P', 'Mg', 'Al', 'Fe', 'Ti', 'Zr', 'Ce'],
                    'water': ['Li', 'Na', 'K', 'Rb', 'Cs', 'Fr', 'Ca', 'Sr', 'Ba'],
                    'asphyxiant': ['He', 'Ne', 'Ar', 'Kr', 'Xe', 'Rn', 'N', 'H'],
                    'pyrophoric': ['Li', 'Na', 'K', 'Rb', 'Cs', 'P', 'Ce'],
                    'oxidizer': ['O', 'F', 'Cl', 'Br'],
                    'radioactive': ['U', 'Pu', 'Ra', 'Th', 'Rn', 'Po', 'Tc', 'Sr', 'Am', 'Cf', 'Cm', 'Np', 'Pa', 'Ac', 'Pm', 'Fr', 'At', 'Bi', 'Es', 'Fm', 'Md', 'No', 'Lr']
                };
                
                // Categories mapping with alternative search terms
                const categoryTerms = {
                    'alkali metal': ['alkali', 'alkali metal', 'alkali metals', 'group 1'],
                    'alkaline earth metal': ['alkaline', 'earth', 'alkaline earth', 'alkaline earth metal', 'alkaline earth metals', 'group 2'],
                    'transition metal': ['transition', 'transition metal', 'transition metals', 'd-block'],
                    'post-transition metal': ['post-transition', 'post transition', 'post-transition metal', 'post-transition metals', 'poor metal'],
                    'metalloid': ['metalloid', 'metalloids', 'semi-metal', 'semi metal', 'semimetal'],
                    'nonmetal': ['nonmetal', 'nonmetals', 'non-metal', 'non metal'],
                    'halogen': ['halogen', 'halogens', 'group 17'],
                    'noble gas': ['noble', 'noble gas', 'noble gases', 'inert gas', 'group 18'],
                    'lanthanide': ['lanthanide', 'lanthanides', 'rare earth', 'rare-earth'],
                    'actinide': ['actinide', 'actinides', 'actinoid']
                };
                
                let results = [];
                const lowerValue = value.toLowerCase();
                
                // Check if search term matches a hazard property
                for (const [hazardType, symbols] of Object.entries(hazardTerms)) {
                    if (hazardType.toLowerCase().includes(lowerValue)) {
                        // Get all elements with this hazard property
                        const hazardElements = symbols.map(symbol => {
                            return Object.values(elementData).find(el => el.symbol === symbol);
                        }).filter(Boolean); // Remove any undefined elements
                        
                        results = [...results, ...hazardElements];
                    }
                }
                
                // Check if search term matches a category
                for (const [category, searchTerms] of Object.entries(categoryTerms)) {
                    if (searchTerms.some(term => term.toLowerCase().includes(lowerValue) || lowerValue.includes(term.toLowerCase()))) {
                        // Get all elements in this category
                        const categoryElements = Object.values(elementData).filter(element => 
                            element.category && element.category.toLowerCase() === category.toLowerCase()
                        );
                        
                        results = [...results, ...categoryElements];
                    }
                }
                
                // Also include regular search by name, symbol, atomic number
                const nameSymbolResults = Object.values(elementData).filter(element => 
                    element.name.toLowerCase().includes(lowerValue) || 
                    element.symbol.toLowerCase().includes(lowerValue) ||
                    element.number.toString().includes(value)
                );
                
                // Combine results and remove duplicates
                results = [...results, ...nameSymbolResults];
                const uniqueResults = Array.from(new Set(results.map(el => el.number)))
                    .map(number => results.find(el => el.number === number));
                
                // Sort results by atomic number
                uniqueResults.sort((a, b) => a.number - b.number);
                
                // Limit to reasonable number of results
                setSearchResults(uniqueResults.slice(0, 15)); // Increased from 12 to 15
                setShowDropdown(uniqueResults.length > 0);
            };
            
            // Handle element selection from search
            const handleSearchSelect = (element) => {
                setSelectedElement(element);
                setView('atom');
                createAtomicModel(element);
                setSearchTerm('');
                setShowDropdown(false);
            };
            
            // Hazard data for elements
            const getHazardData = (element) => {
                if (!element) return [];
                
                const hazards = [];
                const symbol = element.symbol;
                
                // Expanded hazard data based on comprehensive element properties
                
                // Radioactive elements
                if (['U', 'Pu', 'Ra', 'Th', 'Rn', 'Po', 'Tc', 'Sr', 'Am', 'Cf', 'Cm', 'Np', 'Pa', 'Ac', 'Pm', 'Fr', 'At', 'Bi', 'Es', 'Fm', 'Md', 'No', 'Lr'].includes(symbol)) {
                    hazards.push({ type: 'radioactive', label: 'Radioactive', emoji: 'â˜¢ï¸' });
                }
                
                // Toxic elements
                if (['Be', 'As', 'Pb', 'Hg', 'Cd', 'Tl', 'Os', 'Po', 'Pu', 'F', 'Cl', 'Br', 'I', 'Sb', 'Te', 'Ba', 'Cs', 'Li', 'Na', 'K', 'Rb', 'V', 'Cr', 'Co', 'Ni', 'Se', 'P', 'U'].includes(symbol)) {
                    hazards.push({ type: 'toxic', label: 'Toxic', emoji: 'â˜ ï¸' });
                }
                
                // Extremely toxic elements should be marked as very dangerous
                if (['Pb', 'Hg', 'Cd', 'As', 'Be', 'Tl', 'Po', 'F'].includes(symbol)) {
                    hazards.push({ type: 'extreme-toxic', label: 'Extremely Toxic', emoji: 'âš ï¸' });
                }
                
                // Carcinogenic elements
                if (['Be', 'Cd', 'Ni', 'As', 'Cr'].includes(symbol)) {
                    hazards.push({ type: 'carcinogenic', label: 'Carcinogenic', emoji: 'ðŸ§¬' });
                }
                
                // Corrosive elements
                if (['F', 'Cl', 'Br', 'I', 'Li', 'Na', 'K', 'Rb', 'Cs', 'Fr'].includes(symbol)) {
                    hazards.push({ type: 'corrosive', label: 'Corrosive', emoji: 'ðŸ§ª' });
                }
                
                // Flammable elements
                if (['H', 'Li', 'Na', 'K', 'Rb', 'Cs', 'P', 'Mg', 'Al', 'Fe', 'Ti', 'Zr', 'Ce'].includes(symbol)) {
                    hazards.push({ type: 'flammable', label: 'Flammable', emoji: 'ðŸ”¥' });
                }
                
                // Reacts with water
                if (['Li', 'Na', 'K', 'Rb', 'Cs', 'Fr', 'Ca', 'Sr', 'Ba'].includes(symbol)) {
                    hazards.push({ type: 'water-reactive', label: 'Reacts with Water', emoji: 'ðŸ’§' });
                }
                
                // Asphyxiant gases
                if (['He', 'Ne', 'Ar', 'Kr', 'Xe', 'Rn', 'N', 'H'].includes(symbol)) {
                    hazards.push({ type: 'asphyxiant', label: 'Asphyxiant at High Concentrations', emoji: 'ðŸ˜®â€ðŸ’¨' });
                }
                
                // Pyrophoric (ignites in air)
                if (['Li', 'Na', 'K', 'Rb', 'Cs', 'P', 'Ce'].includes(symbol)) {
                    hazards.push({ type: 'pyrophoric', label: 'Pyrophoric', emoji: 'ðŸ’¥' });
                }
                
                // Oxidizer (supports combustion)
                if (['O', 'F', 'Cl', 'Br'].includes(symbol)) {
                    hazards.push({ type: 'oxidizer', label: 'Oxidizer', emoji: 'âš—ï¸' });
                }
                
                // Other special hazards
                switch(symbol) {
                    case 'H':
                        hazards.push({ type: 'special', label: 'Invisible flame', emoji: 'ðŸ‘»' });
                        break;
                    case 'C':
                        hazards.push({ type: 'special', label: 'Dust can be explosive', emoji: 'ðŸ’¨' });
                        break;
                    case 'P':
                        hazards.push({ type: 'special', label: 'White phosphorus glows in dark', emoji: 'âœ¨' });
                        break;
                    case 'F':
                        hazards.push({ type: 'special', label: 'Most reactive non-metal', emoji: 'âš¡' });
                        break;
                    case 'Hg':
                        hazards.push({ type: 'special', label: 'Bioaccumulates', emoji: 'ðŸ§ ' });
                        break;
                    case 'Pb':
                        hazards.push({ type: 'special', label: 'Neurotoxin', emoji: 'ðŸ§ ' });
                        break;
                    case 'Te':
                        hazards.push({ type: 'special', label: 'Causes garlic breath', emoji: 'ðŸ§„' });
                        break;
                    case 'Rn':
                        hazards.push({ type: 'special', label: 'Accumulates in buildings', emoji: 'ðŸ ' });
                        break;
                    case 'W':
                        hazards.push({ type: 'special', label: 'Highest melting point', emoji: 'ðŸ”†' });
                        break;
                    case 'Os':
                        hazards.push({ type: 'special', label: 'Densest natural element', emoji: 'ðŸ‹ï¸' });
                        break;
                    case 'Bi':
                        hazards.push({ type: 'special', label: 'Used in medicines for stomach upset', emoji: 'ðŸ’Š' });
                        break;
                }
                
                return hazards;
            };
            
            const handleElementClick = (element) => {
                setSelectedElement(element);
                if (view === 'table') {
                    setView('atom');
                    createAtomicModel(element);
                }
            };
            
            const handleBackClick = () => {
                setView('table');
                setSelectedElement(null);
                showPeriodicTable();
            };
            
            return (
                <div className="absolute inset-0 flex flex-col">
                    {/* Header */}
                    <header className="bg-gray-800 p-4 flex justify-between items-center z-10">
                        <h1 className="text-2xl font-bold">Periodic Table</h1>
                        
                        {/* Search bar - centered, shorter width, more rounded */}
                        <div id="search-container" className="relative w-1/4 mx-auto">
                            <input
                                type="text"
                                placeholder="Search elements..."
                                value={searchTerm}
                                onChange={handleSearchChange}
                                onFocus={() => searchResults.length > 0 && setShowDropdown(true)}
                                className="bg-gray-700 text-white px-4 py-2 rounded-full w-full"
                            />
                            {showDropdown && (
                                <div className="absolute top-full left-0 right-0 mt-1 bg-gray-700 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto">
                                    {searchResults.map(element => (
                                        <div 
                                            key={element.number}
                                            className="px-4 py-2 hover:bg-gray-600 cursor-pointer flex justify-between"
                                            onClick={() => handleSearchSelect(element)}
                                        >
                                            <span>{element.name}</span>
                                            <span className="text-gray-300">{element.symbol} ({element.number})</span>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                        
                        {/* GitHub link */}
                        <a 
                            href="https://github.com/Saganaki22/PeriodicTable-old" 
                            target="_blank"
                            rel="noopener noreferrer"
                            className="text-white hover:text-blue-300 transition-colors"
                            title="View on GitHub"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                            </svg>
                        </a>
                    </header>
                    
                    {/* Main content */}
                    <main className="flex-1 relative">
                        {view === 'atom' && selectedElement && (
                            <>
                                {/* Info panel with toggle button on top-left */}
                                <div className="absolute top-4 right-4 z-10">
                                    {/* The info panel container */}
                                    <div 
                                        className={`relative bg-gray-800 p-4 rounded shadow-lg max-w-md overflow-auto max-h-screen transition-all duration-300 ease-in-out ${infoPanelOpen ? 'opacity-100 translate-x-0' : 'opacity-0 translate-x-full'}`}
                                        style={{ 
                                            pointerEvents: infoPanelOpen ? 'all' : 'none',
                                            width: "400px" // Fixed width to ensure consistent toggle button positioning
                                        }}
                                    >
                                        <div className="mb-3">
                                            <h2 className="text-xl font-bold mb-2 break-words">
                                                <a 
                                                    href={`https://en.wikipedia.org/wiki/${selectedElement.name}`} 
                                                    target="_blank" 
                                                    rel="noopener noreferrer"
                                                    className="hover:text-blue-400 hover:underline transition-colors flex items-center"
                                                >
                                                    {selectedElement.name} ({selectedElement.symbol})
                                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                                    </svg>
                                                </a>
                                            </h2>
                                            <button 
                                                onClick={handleBackClick}
                                                className="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm w-full"
                                            >
                                                Back to Periodic Table
                                            </button>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2 mt-2">
                                            <div>
                                                <p><span className="font-semibold">Atomic Number:</span> {selectedElement.number}</p>
                                                <p><span className="font-semibold">Atomic Mass:</span> {selectedElement.atomic_mass}</p>
                                                <p><span className="font-semibold">Category:</span> {selectedElement.category}</p>
                                            </div>
                                            <div>
                                                <p><span className="font-semibold">Electron Config:</span> {selectedElement.electron_configuration_semantic || selectedElement.electron_configuration || 'N/A'}</p>
                                                <p><span className="font-semibold">Phase:</span> {selectedElement.phase}</p>
                                                <p><span className="font-semibold">Discovered:</span> {selectedElement.discovered_by || 'Unknown'}</p>
                                            </div>
                                        </div>
                                        <div className="mt-4">
                                            <h3 className="font-semibold">Summary:</h3>
                                            <p className="text-sm mt-1 overflow-auto max-h-24">{selectedElement.summary || 'No summary available.'}</p>
                                        </div>
                                        <div className="mt-4">
                                            <h3 className="font-semibold">Applications:</h3>
                                            <ul className="text-sm mt-1 list-disc pl-5 overflow-auto max-h-32">
                                                {(selectedElement.applications || ['No applications data available.']).map((app, i) => (
                                                    <li key={i}>{app}</li>
                                                ))}
                                            </ul>
                                        </div>
                                        
                                        {/* Hazard symbols */}
                                        <div className="mt-4">
                                            <h3 className="font-semibold">Hazards:</h3>
                                            <div className="flex flex-wrap gap-2 mt-2">
                                                {getHazardData(selectedElement).length > 0 ? (
                                                    getHazardData(selectedElement).map((hazard, index) => (
                                                        <div key={index} className="flex items-center bg-gray-700 px-2 py-1 rounded">
                                                            <span className="mr-1">{hazard.emoji}</span>
                                                            <span className="text-sm">{hazard.label}</span>
                                                        </div>
                                                    ))
                                                ) : (
                                                    <span className="text-sm">No significant hazards</span>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </>
                        )}
                    </main>
                    
                    {/* Fixed position toggle button for info panel - only visible in atom view */}
                    {view === 'atom' && (
                        <div className="fixed right-0 top-1/2 transform -translate-y-1/2 z-50">
                            <button 
                                onClick={() => setInfoPanelOpen(!infoPanelOpen)}
                                className="bg-gray-700 hover:bg-gray-600 p-2 rounded-l-md text-white"
                                style={{ boxShadow: "-2px 0 5px rgba(0,0,0,0.2)" }}
                            >
                                {infoPanelOpen ? (
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                    </svg>
                                ) : (
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                    </svg>
                                )}
                            </button>
                        </div>
                    )}
                    
                    {/* User guide card - only visible in atom view */}
                    {view === 'atom' && (
                        <div className="fixed left-4 bottom-16 bg-gray-800 p-3 rounded-lg shadow-lg z-20 text-sm opacity-80 hover:opacity-100 transition-opacity">
                            <div className="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span>
                                    <strong>Navigation:</strong> Drag mouse to rotate | Scroll to zoom
                                </span>
                            </div>
                        </div>
                    )}
                    
                    {/* Legend for periodic table view */}
                    {view === 'table' && (
                        <div className="fixed bottom-16 left-4 bg-gray-800 p-4 rounded shadow-lg z-20 max-h-64 overflow-y-auto">
                            <h3 className="text-lg font-bold mb-2">Element Categories</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                                <div className="flex items-center">
                                    <div className="w-4 h-4 alkali-metal mr-2"></div>
                                    <span>Alkali Metals</span>
                                </div>
                                <div className="flex items-center">
                                    <div className="w-4 h-4 alkaline-earth mr-2"></div>
                                    <span>Alkaline Earth Metals</span>
                                </div>
                                <div className="flex items-center">
                                    <div className="w-4 h-4 transition-metal mr-2"></div>
                                    <span>Transition Metals</span>
                                </div>
                                <div className="flex items-center">
                                    <div className="w-4 h-4 post-transition mr-2"></div>
                                    <span>Post-Transition Metals</span>
                                </div>
                                <div className="flex items-center">
                                    <div className="w-4 h-4 metalloid mr-2"></div>
                                    <span>Metalloids</span>
                                </div>
                                <div className="flex items-center">
                                    <div className="w-4 h-4 nonmetal mr-2"></div>
                                    <span>Nonmetals</span>
                                </div>
                                <div className="flex items-center">
                                    <div className="w-4 h-4 halogen mr-2"></div>
                                    <span>Halogens</span>
                                </div>
                                <div className="flex items-center">
                                    <div className="w-4 h-4 noble-gas mr-2"></div>
                                    <span>Noble Gases</span>
                                </div>
                                <div className="flex items-center">
                                    <div className="w-4 h-4 lanthanide mr-2"></div>
                                    <span>Lanthanides</span>
                                </div>
                                <div className="flex items-center">
                                    <div className="w-4 h-4 actinide mr-2"></div>
                                    <span>Actinides</span>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Footer */}
                    <footer className="bg-gray-800 p-3 text-center text-gray-400 text-sm z-10 fixed bottom-0 w-full">
                        <p>Â© 2025 Drbaph All Rights Reserved</p>
                    </footer>
                </div>
            );
        };

        // Render React app
        ReactDOM.render(<App />, document.getElementById('app-root'));

        // THREE.JS CODE
        let scene, camera, renderer, controls;
        let periodicTableGroup, atomGroup;
        const elementBoxes = {};
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let INTERSECTED = null;
        
        // Element data from PubChem API and curated information
        const elementsData = {};
        
        function initPeriodicTable() {
            // Create a scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111827);
            
            // Create a camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 20;
            
            // Create a renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Add orbit controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // Create groups for organization
            periodicTableGroup = new THREE.Group();
            atomGroup = new THREE.Group();
            
            scene.add(periodicTableGroup);
            scene.add(atomGroup);
            atomGroup.visible = false;
            
            // Add lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);
            
            // Add mouse event listeners for interaction
            renderer.domElement.addEventListener('mousemove', onMouseMove, false);
            renderer.domElement.addEventListener('click', onMouseClick, false);
            
            // Start the animation loop
            animate();
        }
        
        async function loadElementData() {
            try {
                // This dataset contains all elements with basic properties
                const response = await fetch('https://raw.githubusercontent.com/Bowserinator/Periodic-Table-JSON/master/periodic-table-lookup.json');
                const data = await response.json();
                
                // Process and store the data
                Object.values(data).forEach(element => {
                    if (typeof element === 'object' && element.number) {
                        // Add applications data (this would normally come from an API but is mocked here)
                        element.applications = getElementApplications(element.symbol);
                        elementsData[element.number] = element;
                    }
                });
                
                // Create the periodic table visualization
                createPeriodicTable();
                
            } catch (error) {
                console.error('Error loading element data:', error);
            }
        }
        
        function createPeriodicTable() {
            const boxSize = 0.9;
            const spacing = 1;
            const startX = -8.5 * spacing;
            const startY = 5 * spacing;
            
            // Standard periodic table layout
            const layout = [
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2],
                [3, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 6, 7, 8, 9, 10],
                [11, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 13, 14, 15, 16, 17, 18],
                [19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
                [37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54],
                [55, 56, '*', 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86],
                [87, 88, '**', 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118],
                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                [0, 0, '*', 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71],
                [0, 0, '**', 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103]
            ];
            
            // Create element boxes
            for (let row = 0; row < layout.length; row++) {
                for (let col = 0; col < layout[row].length; col++) {
                    const atomicNumber = layout[row][col];
                    
                    if (atomicNumber !== 0 && atomicNumber !== '*' && atomicNumber !== '**') {
                        const element = elementsData[atomicNumber];
                        
                        if (element) {
                            // Create element box
                            createElementBox(
                                element,
                                startX + col * spacing,
                                startY - row * spacing,
                                boxSize
                            );
                        }
                    }
                }
            }
        }
        
        function createElementBox(element, x, y, size) {
            // Get color based on element category
            const color = getCategoryColor(element.category);
            
            // Create box geometry
            const geometry = new THREE.BoxGeometry(size, size, size * 0.25);
            const material = new THREE.MeshPhongMaterial({ 
                color: color,
                transparent: true,
                opacity: 0.9,
                specular: 0x111111
            });
            
            const box = new THREE.Mesh(geometry, material);
            box.position.set(x, y, 0);
            box.userData.element = element;
            
            // Add symbol text - LARGER
            const symbolText = createTextSprite(element.symbol, 0.8, 0xffffff);
            symbolText.position.set(0, 0, 0.15);
            box.add(symbolText);
            
            // Add atomic number text - LARGER
            const atomicNumText = createTextSprite(element.number.toString(), 0.4, 0xffffff);
            atomicNumText.position.set(-0.25, 0.25, 0.15);
            box.add(atomicNumText);
            
            // Store reference to the box
            elementBoxes[element.number] = box;
            
            // Add to scene
            periodicTableGroup.add(box);
        }
        
        // Regular text sprite function for element symbols and numbers
        function createTextSprite(text, size, color) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 256;
            
            context.font = "Bold 80px Arial";  // Increased from 64px to 80px
            context.fillStyle = "rgba(255, 255, 255, 1.0)";
            context.textAlign = "center";
            context.fillText(text, 128, 128);
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(size, size, 1);
            
            return sprite;
        }
        
        // Special function just for element names to prevent cutting
        function createElementNameSprite(text, size, canvasWidth = 1024) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = canvasWidth;  // Can specify width for extra-wide text
            canvas.height = 512; // Increased height for text clarity
            
            // Clear background
            context.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw text with more padding
            context.font = "Bold 90px Arial";  // Adjusted from 100px to 90px for better fit
            context.fillStyle = "rgba(255, 255, 255, 1.0)";
            context.textAlign = "center";
            context.fillText(text, canvas.width/2, canvas.height/2);
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ 
                map: texture,
                transparent: true
            });
            const sprite = new THREE.Sprite(material);
            
            // Scale based on canvas dimensions
            const aspectRatio = canvasWidth / 512; // Match the new height
            sprite.scale.set(size * aspectRatio, size, 1);
            
            return sprite;
        }
        
        function getCategoryColor(category) {
            const colorMap = {
                'alkali metal': 0xff8a80,
                'alkaline earth metal': 0xff80ab,
                'transition metal': 0xea80fc,
                'post-transition metal': 0xb388ff,
                'metalloid': 0x8c9eff,
                'nonmetal': 0x82b1ff,
                'halogen': 0x80d8ff,
                'noble gas': 0x84ffff,
                'lanthanide': 0xa7ffeb,
                'actinide': 0xb9f6ca
            };
            
            return colorMap[category.toLowerCase()] || 0xe6ee9c;
        }
        
        // Function to get electron configuration for an element
        function getElementElectronConfig(element) {
            // If element has electron configuration data, use that
            if (element.electron_configuration || element.electron_configuration_semantic) {
                return parseElectronConfiguration(element.electron_configuration_semantic || element.electron_configuration, element.number);
            }
            
            // Otherwise, determine by atomic number
            return getElectronShellsByNumber(element.number);
        }
        
        // Parse electron configuration string into shells
        function parseElectronConfiguration(config, atomicNumber) {
            // Initialize shells object to store electrons per shell
            const shells = {};
            
            // Default shell assignments based on orbital notation
            const shellMap = {
                '1s': 1, 
                '2s': 2, '2p': 2,
                '3s': 3, '3p': 3, '3d': 3,
                '4s': 4, '4p': 4, '4d': 4, '4f': 4,
                '5s': 5, '5p': 5, '5d': 5, '5f': 5,
                '6s': 6, '6p': 6, '6d': 6,
                '7s': 7, '7p': 7
            };
            
            if (!config || typeof config !== 'string') {
                return getElectronShellsByNumber(atomicNumber || 1);
            }
            
            try {
                // Remove noble gas notation if present and expand it
                let fullConfig = config;
                const nobleGasMatch = config.match(/\[(.*?)\]/);
                
                if (nobleGasMatch) {
                    const nobleGasSymbol = nobleGasMatch[1];
                    let baseConfig = '';
                    
                    // Expand noble gas notation
                    switch (nobleGasSymbol) {
                        case 'He':
                            baseConfig = '1s2';
                            break;
                        case 'Ne':
                            baseConfig = '1s2 2s2 2p6';
                            break;
                        case 'Ar':
                            baseConfig = '1s2 2s2 2p6 3s2 3p6';
                            break;
                        case 'Kr':
                            baseConfig = '1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6';
                            break;
                        case 'Xe':
                            baseConfig = '1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6';
                            break;
                        case 'Rn':
                            baseConfig = '1s2 2s2 2p6 3s2 3p6 4s2 3d10 4p6 5s2 4d10 5p6 6s2 4f14 5d10 6p6';
                            break;
                    }
                    
                    fullConfig = baseConfig + ' ' + config.replace(/\[.*?\]\s?/, '');
                }
                
                // Split into individual orbital components
                const configParts = fullConfig.trim().split(/\s+/);
                
                // Process each part
                for (const part of configParts) {
                    // Match patterns like "1s2", "2p6", etc.
                    const match = part.match(/^(\d[spdf])(\d+)$/);
                    
                    if (match) {
                        const orbital = match[1];   // e.g., "1s", "2p"
                        const electrons = parseInt(match[2]);  // e.g., 2, 6
                        const shell = shellMap[orbital] || parseInt(orbital[0]);
                        
                        if (shells[shell]) {
                            shells[shell] += electrons;
                        } else {
                            shells[shell] = electrons;
                        }
                    }
                }
            } catch (error) {
                console.error("Error parsing electron configuration:", error);
            }
            
            // If no shells were parsed or there was an error, 
            // create a correct distribution based on atomic number
            if (Object.keys(shells).length === 0) {
                return getElectronShellsByNumber(atomicNumber || 1);
            }
            
            return shells;
        }
        
        // Helper function to get correct shells by atomic number
        function getElectronShellsByNumber(atomicNumber) {
            const shells = {};
            let remaining = atomicNumber;
            
            // Standard shell capacities (2nÂ²)
            const shellCapacities = [0, 2, 8, 18, 32, 32, 18, 8];
            
            // Fill shells according to capacity
            for (let shell = 1; shell <= 7; shell++) {
                if (remaining <= 0) break;
                
                const shellCapacity = shellCapacities[shell];
                const electrons = Math.min(remaining, shellCapacity);
                
                if (electrons > 0) {
                    shells[shell] = electrons;
                }
                
                remaining -= electrons;
            }
            
            return shells;
        }
        
        function createAtomicModel(element) {
            // Hide periodic table and show atom group
            periodicTableGroup.visible = false;
            atomGroup.visible = true;
            
            // Clear previous atom model
            while (atomGroup.children.length > 0) {
                const object = atomGroup.children[0];
                if (object.geometry) object.geometry.dispose();
                if (object.material) {
                    if (Array.isArray(object.material)) {
                        object.material.forEach(m => m.dispose());
                    } else {
                        object.material.dispose();
                    }
                }
                atomGroup.remove(object);
            }
            
            // Center the camera - move further back to see all text
            camera.position.set(0, 0, 40); // Increased from 32 to 40 for better visibility
            controls.target.set(0, 0, 0);
            
            // Create nucleus with appropriate color for Bohr-style representation
            const nucleusGeometry = new THREE.SphereGeometry(2.5, 32, 32);
            const nucleusMaterial = new THREE.MeshPhongMaterial({
                color: 0xff9999, // Pink color similar to the Bohr model
                emissive: 0x441111,
                specular: 0xffffff,
                shininess: 30
            });
            const nucleus = new THREE.Mesh(nucleusGeometry, nucleusMaterial);
            
            // Add element symbol using a transparent sprite with no background
            const symbolSprite = createElementSymbolSprite(element.symbol, 2.5);
            symbolSprite.position.set(0, 0, 3); // Position in front of nucleus
            nucleus.add(symbolSprite);
            
            // Helper function to create element symbol sprites
            function createElementSymbolSprite(text, size) {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 256;
                canvas.height = 256;
                
                // Clear background to transparent
                context.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw text with clean white appearance
                context.font = "Bold 128px Arial";
                context.fillStyle = "rgba(255, 255, 255, 1.0)";
                context.textAlign = "center";
                context.textBaseline = "middle";
                context.fillText(text, 128, 128);
                
                const texture = new THREE.CanvasTexture(canvas);
                const material = new THREE.SpriteMaterial({ 
                    map: texture,
                    transparent: true,
                    opacity: 0.9
                });
                const sprite = new THREE.Sprite(material);
                sprite.scale.set(size, size, 1);
                
                return sprite;
            }
            atomGroup.add(nucleus);
            
            // Get accurate electron configuration for this element
            const electronConfig = getElementElectronConfig(element);
            
            // Create electron shells with Bohr-style appearance
            let shellRadius = 5; // Start radius
            let shellIncrement = 3; // Space between shells
            
            // Create shells and electrons
            let shellNumber = 0;
            const shellKeys = Object.keys(electronConfig).sort((a, b) => parseInt(a) - parseInt(b));
            
            for (const shell of shellKeys) {
                const electrons = electronConfig[shell];
                shellNumber = parseInt(shell);
                
                // Skip empty shells
                if (electrons <= 0) continue;
                
                // Create visible shell (orbit ring)
                const orbitGeometry = new THREE.TorusGeometry(shellRadius, 0.12, 16, 100);
                const orbitMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0x00aaff, // Brighter blue color for better visibility
                    transparent: false,
                    opacity: 1.0
                });
                const orbitRing = new THREE.Mesh(orbitGeometry, orbitMaterial);
                orbitRing.rotation.x = Math.PI / 2; // Lay flat on XY plane
                atomGroup.add(orbitRing);
                
                // Create electrons
                const electronGeometry = new THREE.SphereGeometry(0.4, 16, 16);
                const electronMaterial = new THREE.MeshPhongMaterial({
                    color: 0x00ccff, // Bright cyan for electrons
                    emissive: 0x0088aa,
                    specular: 0xffffff,
                    shininess: 30
                });
                
                // Create a group for the shell
                const electronShellGroup = new THREE.Group();
                electronShellGroup.rotation.x = Math.PI / 2; // Same orientation as orbit ring
                atomGroup.add(electronShellGroup);
                
                // Add electrons to the shell evenly distributed
                for (let i = 0; i < electrons; i++) {
                    // Calculate angle for even distribution
                    const angle = (i / electrons) * Math.PI * 2;
                    
                    // Position electron directly on the orbital path
                    const x = shellRadius * Math.cos(angle);
                    const y = shellRadius * Math.sin(angle);
                    
                    const electron = new THREE.Mesh(electronGeometry, electronMaterial);
                    electron.position.set(x, y, 0);
                    
                    // Store animation data for each electron
                    electron.userData = {
                        isElectron: true,
                        shellNumber: shellNumber,
                        shellRadius: shellRadius,
                        initialAngle: angle,
                        // Outer shells move slower (like planets)
                        rotationSpeed: 0.5 / (0.8 + shellNumber * 0.2)
                    };
                    
                    electronShellGroup.add(electron);
                }
                
                // Increase radius for next shell
                shellRadius += shellIncrement;
            }
            
            // Add element name text
            const nameSprite = createElementNameSprite(`${element.name} (${element.symbol})`, 10, 1800);  // Size increased from 5 to 10, width from 1200 to 1800
            nameSprite.position.set(0, 10, 0);
            atomGroup.add(nameSprite);
            
            // Add atomic number and composition information below the model
            const numProtons = element.number;
            const atomicMass = parseFloat(element.atomic_mass) || numProtons;
            const numNeutrons = Math.round(atomicMass) - numProtons;
            
            // Format electron shell configuration with proper spacing
            // Create multiple lines if needed for longer configurations
            const shellConfig = Object.entries(electronConfig)
                .sort((a, b) => parseInt(a[0]) - parseInt(b[0]));
            
            // First line - composition info
            const compositionText = createElementNameSprite(
                `Protons: ${numProtons} | Neutrons: ${numNeutrons} | Electrons: ${numProtons}`, 
                6.0,  // Increased from 4.0 to 6.0 for larger text
                3000
            );
            compositionText.position.set(0, -10, 0);
            atomGroup.add(compositionText);
            
            // Split shell configuration into smaller chunks for better readability
            const shellTexts = shellConfig.map(([shell, count]) => `Shell ${shell}: ${count} electrons`);
            
            // Create one line for each pair of shells, or just show all on one line if only 2-3 shells
            const totalShells = shellTexts.length;
            let shellsPerLine = 2;
            
            if (totalShells <= 2) {
                shellsPerLine = totalShells; // All on one line if 2 or fewer
            }
            
            // Create lines of shell configuration text
            let linesOfText = [];
            for (let i = 0; i < shellTexts.length; i += shellsPerLine) {
                linesOfText.push(shellTexts.slice(i, i + shellsPerLine).join(' | '));
            }
            
            // Position each line with minimal vertical spacing
            linesOfText.forEach((line, index) => {
                const configTextLine = createElementNameSprite(line, 6.0, 3000); // Size increased from 4.0 to 6.0
                // Position lines closer together - only 3 units apart instead of 5
                configTextLine.position.set(0, -15 - (index * 3), 0);
                atomGroup.add(configTextLine);
            });
        }

        function showPeriodicTable() {
            periodicTableGroup.visible = true;
            atomGroup.visible = false;
            
            // Reset camera position
            camera.position.set(0, 0, 20);
            controls.target.set(0, 0, 0);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function onMouseMove(event) {
            // Calculate mouse position in normalized device coordinates
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Only check intersections with periodic table when it's visible
            if (periodicTableGroup.visible) {
                // Update the raycaster
                raycaster.setFromCamera(mouse, camera);
                
                // Find intersections with element boxes
                const intersects = raycaster.intersectObjects(periodicTableGroup.children);
                
                if (intersects.length > 0) {
                    // If we found an intersection
                    if (INTERSECTED != intersects[0].object) {
                        // Reset previous intersection
                        if (INTERSECTED) {
                            INTERSECTED.material.emissive.setHex(INTERSECTED.currentHex);
                        }
                        
                        // Store new intersection
                        INTERSECTED = intersects[0].object;
                        INTERSECTED.currentHex = INTERSECTED.material.emissive.getHex();
                        INTERSECTED.material.emissive.setHex(0x333333);
                        
                        // Show tooltip ONLY in table view
                        const element = INTERSECTED.userData.element;
                        if (element) {
                            const tooltip = document.getElementById('element-tooltip');
                            tooltip.innerHTML = `
                                <div>
                                    <div><strong>${element.name} (${element.symbol})</strong></div>
                                    <div>Atomic number: ${element.number}</div>
                                    <div>Atomic mass: ${element.atomic_mass}</div>
                                    <div>Category: ${element.category}</div>
                                </div>
                            `;
                            tooltip.style.left = (event.clientX + 15) + 'px';
                            tooltip.style.top = (event.clientY + 15) + 'px';
                            tooltip.style.display = 'block';
                        }
                    }
                } else {
                    // No intersection found
                    if (INTERSECTED) {
                        INTERSECTED.material.emissive.setHex(INTERSECTED.currentHex);
                        INTERSECTED = null;
                        
                        // Hide tooltip
                        document.getElementById('element-tooltip').style.display = 'none';
                    }
                }
            } else {
                // We're in atom view, make sure tooltip is hidden
                document.getElementById('element-tooltip').style.display = 'none';
            }
        }
        
        function onMouseClick(event) {
            // Only handle clicks on periodic table when it's visible
            if (periodicTableGroup.visible && INTERSECTED) {
                const element = INTERSECTED.userData.element;
                if (element) {
                    // Update React state through a custom event
                    const event = new CustomEvent('elementSelected', { detail: element });
                    document.dispatchEvent(event);
                }
            }
        }
        
        // Initialize hazard data
        function initElementHazards() {
            // Already handled in React component
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // Update controls
            controls.update();
            
            // Animate electrons if atom view is active
            if (atomGroup.visible) {
                // Update each electron position with smooth animation
                atomGroup.traverse(child => {
                    if (child.userData && child.userData.isElectron) {
                        // Calculate new position to maintain perfectly circular orbit
                        const electron = child;
                        const time = Date.now() * 0.001;
                        const speed = electron.userData.rotationSpeed;
                        const radius = electron.userData.shellRadius;
                        const shellNumber = electron.userData.shellNumber;
                        const initialAngle = electron.userData.initialAngle;
                        
                        // Calculate new angle based on time, speed, and initial offset
                        const angle = initialAngle + time * speed;
                        
                        // Update position to stay exactly on the orbital path
                        electron.position.x = radius * Math.cos(angle);
                        electron.position.y = radius * Math.sin(angle);
                    }
                });
            }
            
            // Render the scene
            renderer.render(scene, camera);
        }
        
        // Helper function to get mock applications data
        function getElementApplications(symbol) {
            const applicationsData = {
                'H': ['Fuel for stars', 'Hydrogen fuel cells', 'Industrial processes'],
                'He': ['Cooling superconducting magnets', 'Lifting balloons', 'Deep-sea diving mixtures'],
                'Li': ['Lithium-ion batteries', 'Psychiatric medications', 'Aerospace alloys'],
                'Be': ['Aerospace components', 'X-ray windows', 'Nuclear reactors'],
                'C': ['Structural materials', 'Organic chemistry', 'Energy storage'],
                'O': ['Respiration', 'Combustion', 'Industrial oxidation'],
                'Na': ['Salt (NaCl)', 'Street lighting', 'Heat transfer in nuclear reactors'],
                'Al': ['Lightweight structural materials', 'Packaging', 'Electrical transmission lines'],
                'Si': ['Semiconductors', 'Solar cells', 'Glass production'],
                'Fe': ['Structural steel', 'Vehicles', 'Machinery manufacturing'],
                'Cu': ['Electrical wiring', 'Plumbing', 'Electronics'],
                'Ag': ['Electronics', 'Photography', 'Antimicrobial applications'],
                'Au': ['Electronics', 'Jewelry', 'Dentistry'],
                'Hg': ['Thermometers', 'Fluorescent lighting', 'Dental amalgams'],
                'Pb': ['Batteries', 'Radiation shielding', 'Historical plumbing'],
                'U': ['Nuclear fuel', 'Military applications', 'Radiation shielding'],
            };
            
            return applicationsData[symbol] || ['Industrial applications', 'Scientific research'];
        }
    </script>
</body>
</html>
